# Weather Informer (Rails 7.2)

Простое сервис-приложение для информирования о погоде с двумя ролями (**администратор** и **пользователь**), аутентификацией, управлением городами и прогнозами погоды.

## Возможности

- Ruby 3.3.4 / Rails 7.2
- База данных PostgreSQL
- Аутентификация через Devise
- Ролевая авторизация с CanCanCan
    - **Администратор**: может создавать и управлять городами
    - **Пользователь**: может просматривать города и смотреть прогноз погоды
- Интеграция с API погоды
- Кэширование прогнозов
- Тестовый набор на RSpec с FactoryBot и Shoulda
- Поддержка Docker Compose (web, db)
- Поддержка Procfile (Foreman/Overmind)

## Установка

### Требования

- Ruby 3.3.4
- PostgreSQL 16+
- Docker (optional)

### Запуск вручную

```bash
git clone https://github.com/sergestrange/weather-informer-rails.git
cd weather-informer-rails

bundle install
bin/rails db:setup
rake db:seed
foreman start -f Procfile.dev
```
### Docker

```bash
docker build -t weather-informer .
```

## Архитектура и особенности реализации

### Weather Service Layer

Приложение использует абстракцию `Weather` для работы с разными провайдерами прогноза погоды.  
Основная точка входа — сервисы:

- `Weather::FetchDaily` — получает прогноз на N дней (шаг 24 часа) следуя либо в API, либо в кэш.

#### Пример использования

```ruby
city = City.find(1)
forecast = Weather::FetchDaily.call(city: city, days: 7)
# => {
#   type: "daily",
#   days: [
#     { date: Date.today, t_min: 12.0, t_max: 19.0, wind_speed_max: 3.1, provider: "open_meteo" },
#     ...
#   ],
#   provider: "open_meteo"
# }
```
### Yandex карты для геопозиции

Использован `Stimulus` для упорядочивования в коде JS компонентов, с его помощью, а также `ViewComponent`, добавлен просмотрщик текущего местоположения по координатам города. Можно изменить на условно бесплатный `Leaflet`.

## Roadmap

- Для большей стабильности подключения по API, можно воспользоваться заложенным механизмом с Circuitbox для обработки в случае fallback, и добавить вспомогательный Provider, например Gismeteo.
- Реализовать возможность просмотра прогноза на сегодняшний день, на месяц вперед и расширить количество получаемых данных от API.
- Сделать панель администратора с редактирование прав доступа.
- Добавить элементы перехода по страницам в UI, а также выход из профиля.
- Скорректировать UI, добавить стили, иконки и пр.
